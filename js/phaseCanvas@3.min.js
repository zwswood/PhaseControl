;(function($,window,document){var Phase=function(options){this.oBgCanvas=null;this.canBgContext=null;this.oCanvas=null;this.canContext=null;this.drawBg=new Image();this.drawBg.src='img/PhaseShape@3.png';this.drawImg=new Image();this.drawImg.src='img/SignalChy-tech@3.png';this.arrayDraw=[];this.greenMap=new Map();this.allSignalMap=new Map();this.signalDisp=['1A','1S','1L','1R','1P','11P','12P','2A','2S','2L','2R','2P','21P','22P','3A','3S','3L','3R','3P','31P','32P','4A','4S','4L','4R','4P','41P','42P'];this.signalCode=['001','002','003','004','007','008','009','033','034','035','036','039','040','041','065','066','067','068','071','072','073','097','098','099','100','103','104','105'];if(!(this instanceof Phase))return new Phase(options);this.options=this.extend({crossShape:2,phaseId:0,usableSignal:'1L,1S,1R,1A,2L,2S,2R,2A,3L,3S,3R,3A,4L,4S,4R,4A,11P,12P,21P,22P,31P,32P,41P,42P,1P',greenSignal:'',clashSignal:[]},options)for(var i=0;i<this.signalDisp.length;i++){this.allSignalMap.set(this.signalDisp[i],this.signalCode[i])}this.options.usableSignal=this.options.usableSignal.toUpperCase();this.options.greenSignal=this.options.greenSignal.toUpperCase();this.init()};Phase.prototype={extend:function(obj,obj2){for(var k in obj2){obj[k]=obj2[k]}return obj},init:function(){var _self=this;var div=document.createElement('div');div.style="position: relative;width:606px;height:606px;display:inline-block;";var bgCanvas=document.createElement('canvas');bgCanvas.id="canvasBg";bgCanvas.width=600;bgCanvas.height=600;bgCanvas.style="border: 3px solid #3f5c65;position: absolute;top: 0;left: 0;";div.appendChild(bgCanvas);var pCanvas=document.createElement('canvas');pCanvas.id="canvasImg";pCanvas.width=600;pCanvas.height=600;pCanvas.style="border: 3px solid #3f5c65;position: absolute;top: 0;left: 0;";div.appendChild(pCanvas);var pTips=document.createElement('p');pTips.style="position: absolute;display: none;top: 50%;left: 50%;font-size: 18px;color: #d60202;margin: 0;margin: -20px 0 0 -115px;text-align: center;line-height: 40px;padding: 0;text-shadow: 2px 2px 2px #5a0505;background: #3a3030;width: 230px;height: 45px;border: #522f07 1px solid;box-shadow: #171515 2px 2px 4px 1px;border-color: #cc0707 #840a0a #860f0f #ca1313;z-index:100;";div.appendChild(pTips);$("#showContainer").append(div);var bgid='canvasBg';_self.oBgCanvas=document.getElementById(bgid);if(_self.oBgCanvas==null)return;if(!_self.oBgCanvas.getContext)return;_self.canBgContext=_self.oBgCanvas.getContext("2d");var id='canvasImg';_self.oCanvas=document.getElementById(id);if(_self.oCanvas==null)return;if(!_self.oCanvas.getContext)return;_self.canContext=_self.oCanvas.getContext("2d");_self.drawBg.onload=()=>{_self.drawCrossShape()};_self.drawImg.onload=()=>{_self.drawSignalLight()};this.event()},drawPhaseId:function(){var _self=this;_self.canContext.clearRect(0,0,100,100);_self.canContext.beginPath();var circle={x:50,y:50,r:32};_self.canContext.arc(circle.x,circle.y,circle.r,0,Math.PI*2,true);_self.canContext.lineWidth=4;_self.canContext.strokeStyle="#FF0000";_self.canContext.fillStyle="#00FF00";_self.canContext.font="40px Arial";_self.canContext.textAlign='center';_self.canContext.textBaseline='middle'_self.canContext.fillText(_self.options.phaseId,circle.x,circle.y+1);_self.canContext.stroke()},drawCrossShape:function(){var _self=this;switch(Number(_self.options.crossShape)){case 0:_self.canBgContext.drawImage(_self.drawBg,0,0,600,600,0,0,600,600);break;case 1:_self.canBgContext.drawImage(_self.drawBg,600,0,600,600,0,0,600,600);break;case 2:_self.canBgContext.drawImage(_self.drawBg,1200,0,600,600,0,0,600,600);break;case 3:_self.canBgContext.drawImage(_self.drawBg,1800,0,600,600,0,0,600,600);break;case 4:_self.canBgContext.drawImage(_self.drawBg,2400,0,600,600,0,0,600,600);break;case 5:_self.canBgContext.drawImage(_self.drawBg,3000,0,600,600,0,0,600,600);break;case 6:_self.canBgContext.drawImage(_self.drawBg,3600,0,600,600,0,0,600,600);break}},filterData:function(arrayGroup){if(arrayGroup.indexOf('1P')>-1){var index_11p=arrayGroup.indexOf('11P');if(index_11p>-1){arrayGroup.splice(index_11p,1)};var index_12p=arrayGroup.indexOf('12P');if(index_12p>-1){arrayGroup.splice(index_12p,1)}}if(arrayGroup.indexOf('2P')>-1){var index_21p=arrayGroup.indexOf('21P');if(index_21p>-1){arrayGroup.splice(index_21p,1)};var index_22p=arrayGroup.indexOf('22P');if(index_22p>-1){arrayGroup.splice(index_22p,1)}}if(arrayGroup.indexOf('3P')>-1){var index_31p=arrayGroup.indexOf('31P');if(index_31p>-1){arrayGroup.splice(index_31p,1)};var index_32p=arrayGroup.indexOf('32P');if(index_32p>-1){arrayGroup.splice(index_32p,1)}}if(arrayGroup.indexOf('4P')>-1){var index_41p=arrayGroup.indexOf('41P');if(index_41p>-1){arrayGroup.splice(index_41p,1)};var index_42p=arrayGroup.indexOf('42P');if(index_42p>-1){arrayGroup.splice(index_42p,1)}}},drawSignalLight:function(){var _self=this;if(_self.options.usableSignal){var thisCrossShape=Number(_self.options.crossShape);var signalGroup=_self.options.usableSignal.split(',');_self.filterData(signalGroup);for(var key in signalGroup){switch(signalGroup[key]){case"1A":switch(thisCrossShape){case 2:_self.canContext.drawImage(_self.drawImg,540,0,54,48,450,135,54,48);_self.arrayDraw.push({ix:540,iy:0,x:450,y:135,w:54,h:48,disp:'1A'});break}break;case"1L":switch(thisCrossShape){case 2:case 3:case 5:_self.canContext.drawImage(_self.drawImg,0,0,54,27,450,255,54,27);_self.arrayDraw.push({ix:0,iy:0,x:450,y:255,w:54,h:27,disp:'1L'});break}break;case"1S":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,60,0,54,27,203,196,54,27);_self.arrayDraw.push({ix:60,iy:0,x:203,y:196,w:54,h:27,disp:'1S'});break;case 2:case 5:case 6:_self.canContext.drawImage(_self.drawImg,60,0,54,27,450,225,54,27);_self.arrayDraw.push({ix:60,iy:0,x:450,y:225,w:54,h:27,disp:'1S'});break}break;case"1R":switch(thisCrossShape){case 2:case 3:case 6:_self.canContext.drawImage(_self.drawImg,120,0,54,27,450,195,54,27);_self.arrayDraw.push({ix:120,iy:0,x:450,y:195,w:54,h:27,disp:'1R'});break}break;case"2A":switch(thisCrossShape){case 2:_self.canContext.drawImage(_self.drawImg,600,0,54,48,96,417,54,48);_self.arrayDraw.push({ix:600,iy:0,x:96,y:417,w:54,h:48,disp:'2A'});break}break;case"2L":switch(thisCrossShape){case 2:case 4:case 6:_self.canContext.drawImage(_self.drawImg,300,0,54,27,96,318,54,27);_self.arrayDraw.push({ix:300,iy:0,x:96,y:318,w:54,h:27,disp:'2L'});break}break;case"2S":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,240,0,54,27,370,350,54,27);_self.arrayDraw.push({ix:240,iy:0,x:370,y:350,w:54,h:27,disp:'2S'});break;case 2:case 5:case 6:_self.canContext.drawImage(_self.drawImg,240,0,54,27,96,348,54,27);_self.arrayDraw.push({ix:240,iy:0,x:96,y:348,w:54,h:27,disp:'2S'});break}break;case"2R":switch(thisCrossShape){case 2:case 4:case 5:_self.canContext.drawImage(_self.drawImg,180,0,54,27,96,378,54,27);_self.arrayDraw.push({ix:180,iy:0,x:96,y:378,w:54,h:27,disp:'2R'});break}break;case"3A":switch(thisCrossShape){case 2:_self.canContext.drawImage(_self.drawImg,660,0,48,54,417,450,48,54);_self.arrayDraw.push({ix:660,iy:0,x:417,y:450,w:48,h:54,disp:'3A'});break}break;case"3L":switch(thisCrossShape){case 2:case 4:case 5:_self.canContext.drawImage(_self.drawImg,360,0,27,54,318,450,27,54);_self.arrayDraw.push({ix:360,iy:0,x:318,y:450,w:27,h:54,disp:'3L'});break}break;case"3S":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,390,0,27,54,370,186,27,54);_self.arrayDraw.push({ix:390,iy:0,x:370,y:186,w:27,h:54,disp:'3S'});break;case 2:case 3:case 4:_self.canContext.drawImage(_self.drawImg,390,0,27,54,348,450,27,54);_self.arrayDraw.push({ix:390,iy:0,x:348,y:450,w:27,h:54,disp:'3S'});break}break;case"3R":switch(thisCrossShape){case 2:case 3:case 5:_self.canContext.drawImage(_self.drawImg,420,0,27,54,378,450,27,54);_self.arrayDraw.push({ix:420,iy:0,x:378,y:450,w:27,h:54,disp:'3R'});break}break;case"4A":switch(thisCrossShape){case 2:_self.canContext.drawImage(_self.drawImg,720,0,48,54,135,96,48,54);_self.arrayDraw.push({ix:720,iy:0,x:135,y:96,w:48,h:54,disp:'4A'});break}break;case"4L":switch(thisCrossShape){case 2:case 3:case 6:_self.canContext.drawImage(_self.drawImg,510,0,27,54,255,96,27,54);_self.arrayDraw.push({ix:510,iy:0,x:255,y:96,w:27,h:54,disp:'4L'});break}break;case"4S":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,480,0,27,54,203,350,27,54);_self.arrayDraw.push({ix:480,iy:0,x:203,y:350,w:27,h:54,disp:'4S'});break;case 2:case 3:case 4:_self.canContext.drawImage(_self.drawImg,480,0,27,54,225,96,27,54);_self.arrayDraw.push({ix:480,iy:0,x:225,y:96,w:27,h:54,disp:'4S'});break}break;case"4R":switch(thisCrossShape){case 2:case 4:case 6:_self.canContext.drawImage(_self.drawImg,450,0,27,54,195,96,27,54);_self.arrayDraw.push({ix:450,iy:0,x:195,y:96,w:27,h:54,disp:'4R'});break}break;case"1P":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,810,0,18,336,291,132,18,336);_self.arrayDraw.push({ix:810,iy:0,x:291,y:132,w:18,h:336,disp:'1P'});break;case 2:case 3:case 5:case 6:_self.canContext.drawImage(_self.drawImg,810,0,18,336,528,132,18,336);_self.arrayDraw.push({ix:810,iy:0,x:528,y:132,w:18,h:336,disp:'1P'});break}break;case"2P":switch(thisCrossShape){case 2:case 4:case 5:case 6:_self.canContext.drawImage(_self.drawImg,810,0,18,336,54,132,18,336);_self.arrayDraw.push({ix:810,iy:0,x:54,y:132,w:18,h:336,disp:'2P'});break}break;case"3P":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,0,60,336,18,132,291,336,18);_self.arrayDraw.push({ix:0,iy:60,x:132,y:291,w:336,h:18,disp:'3P'});break;case 2:case 3:case 4:case 5:_self.canContext.drawImage(_self.drawImg,0,60,336,18,132,528,336,18);_self.arrayDraw.push({ix:0,iy:60,x:132,y:528,w:336,h:18,disp:'3P'});break}break;case"4P":switch(thisCrossShape){case 2:case 3:case 4:case 6:_self.canContext.drawImage(_self.drawImg,0,60,336,18,132,54,336,18);_self.arrayDraw.push({ix:0,iy:60,x:132,y:54,w:336,h:18,disp:'4P'});break}break case"11P":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,780,0,18,156,291,132,18,156);_self.arrayDraw.push({ix:780,iy:0,x:291,y:132,w:18,h:156,disp:'11P'});break;case 2:case 3:case 5:case 6:_self.canContext.drawImage(_self.drawImg,780,0,18,156,528,132,18,156);_self.arrayDraw.push({ix:780,iy:0,x:528,y:132,w:18,h:156,disp:'11P'});break}break;case"12P":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,780,0,18,156,291,312,18,156);_self.arrayDraw.push({ix:780,iy:0,x:291,y:312,w:18,h:156,disp:'12P'});break;case 2:case 3:case 5:case 6:_self.canContext.drawImage(_self.drawImg,780,0,18,156,528,312,18,156);_self.arrayDraw.push({ix:780,iy:0,x:528,y:312,w:18,h:156,disp:'12P'});break}break;case"21P":switch(thisCrossShape){case 2:case 4:case 5:case 6:_self.canContext.drawImage(_self.drawImg,780,0,18,156,54,312,18,156);_self.arrayDraw.push({ix:780,iy:0,x:54,y:312,w:18,h:156,disp:'21P'});break}break;case"22P":switch(thisCrossShape){case 2:case 4:case 5:case 6:_self.canContext.drawImage(_self.drawImg,780,0,18,156,54,132,18,156);_self.arrayDraw.push({ix:780,iy:0,x:54,y:132,w:18,h:156,disp:'22P'});break}break;case"31P":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,0,90,156,18,312,291,156,18);_self.arrayDraw.push({ix:0,iy:90,x:312,y:291,w:156,h:18,disp:'31P'});break;case 2:case 3:case 4:case 5:_self.canContext.drawImage(_self.drawImg,0,90,156,18,312,528,156,18);_self.arrayDraw.push({ix:0,iy:90,x:312,y:528,w:156,h:18,disp:'31P'});break}break;case"32P":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,0,90,156,18,132,291,156,18);_self.arrayDraw.push({ix:0,iy:90,x:132,y:291,w:156,h:18,disp:'32P'});break;case 2:case 3:case 4:case 5:_self.canContext.drawImage(_self.drawImg,0,90,156,18,132,528,156,18);_self.arrayDraw.push({ix:0,iy:90,x:132,y:528,w:156,h:18,disp:'32P'});break}break;case"41P":switch(thisCrossShape){case 2:case 3:case 4:case 6:_self.canContext.drawImage(_self.drawImg,0,90,156,18,132,54,156,18);_self.arrayDraw.push({ix:0,iy:90,x:132,y:54,w:156,h:18,disp:'41P'});break}break;case"42P":switch(thisCrossShape){case 2:case 3:case 4:case 6:_self.canContext.drawImage(_self.drawImg,0,90,156,18,312,54,156,18);_self.arrayDraw.push({ix:0,iy:90,x:312,y:54,w:156,h:18,disp:'42P'});break}break}}}if(_self.options.greenSignal){var useArray=_self.options.usableSignal.split(',');_self.filterData(useArray);var greenGroup=_self.options.greenSignal.split(',');_self.filterData(greenGroup);for(let i=greenGroup.length-1;i>=0;i--){let value=greenGroup[i];if(useArray.indexOf(value)<0){greenGroup.splice(i,1)}}for(var key in greenGroup){_self.greenMap.set(greenGroup[key],_self.allSignalMap.get(greenGroup[key])+',0');switch(greenGroup[key]){case"1A":switch(thisCrossShape){case 2:_self.canContext.drawImage(_self.drawImg,540,600,54,48,450,135,54,48);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='1A'){t.iy=600}return t});break}break;case"1L":switch(thisCrossShape){case 2:case 3:case 5:_self.canContext.drawImage(_self.drawImg,0,600,54,27,450,255,54,27);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='1L'){t.iy=600}return t});break}break;case"1S":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,60,600,54,27,203,196,54,27);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='1S'){t.iy=600}return t});break;case 2:case 5:case 6:_self.canContext.drawImage(_self.drawImg,60,600,54,27,450,225,54,27);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='1S'){t.iy=600}return t});break}break;case"1R":switch(thisCrossShape){case 2:case 3:case 6:_self.canContext.drawImage(_self.drawImg,120,600,54,27,450,195,54,27);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='1R'){t.iy=600}return t});break}break;case"2A":switch(thisCrossShape){case 2:_self.canContext.drawImage(_self.drawImg,600,600,54,48,96,417,54,48);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='2A'){t.iy=600}return t});break}break;case"2L":switch(thisCrossShape){case 2:case 4:case 6:_self.canContext.drawImage(_self.drawImg,300,600,54,27,96,318,54,27);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='2L'){t.iy=600}return t});break}break;case"2S":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,240,600,54,27,370,350,54,27);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='2S'){t.iy=600}return t});break;case 2:case 5:case 6:_self.canContext.drawImage(_self.drawImg,240,600,54,27,96,348,54,27);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='2S'){t.iy=600}return t});break}break;case"2R":switch(thisCrossShape){case 2:case 4:case 5:_self.canContext.drawImage(_self.drawImg,180,600,54,27,96,378,54,27);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='2R'){t.iy=600}return t});break}break;case"3A":switch(thisCrossShape){case 2:_self.canContext.drawImage(_self.drawImg,660,600,48,54,417,450,48,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='3A'){t.iy=600}return t});break}break;case"3L":switch(thisCrossShape){case 2:case 4:case 5:_self.canContext.drawImage(_self.drawImg,360,600,27,54,318,450,27,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='3L'){t.iy=600}return t});break}break;case"3S":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,390,600,27,54,370,186,27,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='3S'){t.iy=600}return t});break;case 2:case 3:case 4:_self.canContext.drawImage(_self.drawImg,390,600,27,54,348,450,27,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='3S'){t.iy=600}return t});break}break;case"3R":switch(thisCrossShape){case 2:case 3:case 5:_self.canContext.drawImage(_self.drawImg,420,600,27,54,378,450,27,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='3R'){t.iy=600}return t});break}break;case"4A":switch(thisCrossShape){case 2:_self.canContext.drawImage(_self.drawImg,720,600,48,54,135,96,48,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='4A'){t.iy=600}return t});break}break;case"4L":switch(thisCrossShape){case 2:case 3:case 6:_self.canContext.drawImage(_self.drawImg,510,600,27,54,255,96,27,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='4L'){t.iy=600}return t});break}break;case"4S":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,480,600,27,54,203,350,27,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='4S'){t.iy=600}return t});break;case 2:case 3:case 4:_self.canContext.drawImage(_self.drawImg,480,600,27,54,225,96,27,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='4S'){t.iy=600}return t});break}break;case"4R":switch(thisCrossShape){case 2:case 4:case 6:_self.canContext.drawImage(_self.drawImg,450,600,27,54,195,96,27,54);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='4R'){t.iy=600}return t});break}break;case"1P":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,810,600,18,336,291,132,18,336);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='1P'){t.iy=600}return t});break;case 2:case 3:case 5:case 6:_self.canContext.drawImage(_self.drawImg,810,600,18,336,528,132,18,336);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='1P'){t.iy=600}return t});break}break;case"2P":switch(thisCrossShape){case 2:case 4:case 5:case 6:_self.canContext.drawImage(_self.drawImg,810,600,18,336,54,132,18,336);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='2P'){t.iy=600}return t});break}break;case"3P":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,0,660,336,18,132,291,336,18);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='3P'){t.iy=660}return t});break;case 2:case 3:case 4:case 5:_self.canContext.drawImage(_self.drawImg,0,660,336,18,132,528,336,18);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='3P'){t.iy=660}return t});break}break;case"4P":switch(thisCrossShape){case 2:case 3:case 4:case 6:_self.canContext.drawImage(_self.drawImg,0,660,336,18,132,54,336,18);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='4P'){t.iy=660}return t});break}break case"11P":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,780,600,18,156,291,132,18,156);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='11P'){t.iy=600}return t});break;case 2:case 3:case 5:case 6:_self.canContext.drawImage(_self.drawImg,780,600,18,156,528,132,18,156);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='11P'){t.iy=600}return t});break}break;case"12P":switch(thisCrossShape){case 0:_self.canContext.drawImage(_self.drawImg,780,600,18,156,291,312,18,156);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='12P'){t.iy=600}return t});break;case 2:case 3:case 5:case 6:_self.canContext.drawImage(_self.drawImg,780,600,18,156,528,312,18,156);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='12P'){t.iy=600}return t});break}break;case"21P":switch(thisCrossShape){case 2:case 4:case 5:case 6:_self.canContext.drawImage(_self.drawImg,780,600,18,156,54,312,18,156);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='21P'){t.iy=600}return t});break}break;case"22P":switch(thisCrossShape){case 2:case 4:case 5:case 6:_self.canContext.drawImage(_self.drawImg,780,600,18,156,54,132,18,156);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='22P'){t.iy=600}return t});break}break;case"31P":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,0,690,156,18,312,291,156,18);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='31P'){t.iy=690}return t});break;case 2:case 3:case 4:case 5:_self.canContext.drawImage(_self.drawImg,0,690,156,18,312,528,156,18);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='31P'){t.iy=690}return t});break}break;case"32P":switch(thisCrossShape){case 1:_self.canContext.drawImage(_self.drawImg,0,690,156,18,132,291,156,18);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='32P'){t.iy=690}return t});break;case 2:case 3:case 4:case 5:_self.canContext.drawImage(_self.drawImg,0,690,156,18,132,528,156,18);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='32P'){t.iy=690}return t});break}break;case"41P":switch(thisCrossShape){case 2:case 3:case 4:case 6:_self.canContext.drawImage(_self.drawImg,0,690,156,18,132,54,156,18);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='41P'){t.iy=690}return t});break}break;case"42P":switch(thisCrossShape){case 2:case 3:case 4:case 6:_self.canContext.drawImage(_self.drawImg,0,690,156,18,312,54,156,18);_self.arrayDraw=_self.arrayDraw.map(t=>{if(t.disp==='42P'){t.iy=690}return t});break}break}}}},getEventPosition:function(ev){var x,y;if(ev.layerX||ev.layerX==0){x=ev.layerX;y=ev.layerY}else if(ev.offsetX||ev.offsetX==0){x=ev.offsetX;y=ev.offsetY}return{x:x,y:y}},event:function(){var _self=this;_self.oCanvas.addEventListener('dblclick',function(e){p=_self.getEventPosition(e);let usableCar=[];let usablePerson=[];for(var i=0;i<_self.arrayDraw.length;i++){if(_self.arrayDraw[i].disp.indexOf('P')>0){usablePerson.push(_self.arrayDraw[i].disp)}else{usableCar.push(_self.arrayDraw[i].disp)}}for(var i=0;i<_self.arrayDraw.length;i++){_self.canContext.fillStyle='rgba(255, 255, 255, 0)';_self.canContext.beginPath();_self.canContext.rect(_self.arrayDraw[i].x,_self.arrayDraw[i].y,_self.arrayDraw[i].w,_self.arrayDraw[i].h);_self.canContext.fill();if(p&&_self.canContext.isPointInPath(p.x,p.y)){_self.canContext.clearRect(_self.arrayDraw[i].x,_self.arrayDraw[i].y,_self.arrayDraw[i].w,_self.arrayDraw[i].h);if(_self.arrayDraw[i].iy<100){var clashSignal;let clashCar=[];let clashPerson=[];_self.options.clashSignal.map(t=>{if(t.sKey===_self.arrayDraw[i].disp){clashSignal=t.sValue}});if(clashSignal){var tempClash=clashSignal.split(',');for(let j=0;j<tempClash.length;j++){if(tempClash[j].indexOf('P')>0){clashPerson.push(tempClash[j])}else{clashCar.push(tempClash[j])}}}let isClash=false;let clashDisp='';for(let m=0;m<clashCar.length;m++){_self.arrayDraw.map(t=>{if(t.disp==clashCar[m]){if(t.iy>100){isClash=true;clashDisp=t.disp;return}}})}if(!isClash){_self.canContext.drawImage(_self.drawImg,_self.arrayDraw[i].ix,_self.arrayDraw[i].iy+600,_self.arrayDraw[i].w,_self.arrayDraw[i].h,_self.arrayDraw[i].x,_self.arrayDraw[i].y,_self.arrayDraw[i].w,_self.arrayDraw[i].h);_self.arrayDraw[i].iy=_self.arrayDraw[i].iy+600;_self.greenMap.set(_self.arrayDraw[i].disp,_self.allSignalMap.get(_self.arrayDraw[i].disp)+',0');for(let b=0;b<clashPerson.length;b++){_self.arrayDraw.map(t=>{if(t.disp==clashPerson[b]){if(t.iy>100){t.iy=t.iy-600;_self.canContext.clearRect(t.x,t.y,t.w,t.h)}_self.canContext.drawImage(_self.drawImg,t.ix,t.iy,t.w,t.h,t.x,t.y,t.w,t.h);_self.greenMap.delete(t.disp)}})}}else{$("#canvasImg+p").html("与信号灯组【"+clashDisp+"】冲突")$("#canvasImg+p").stop().fadeIn(20).delay(700).fadeOut(500);_self.canContext.drawImage(_self.drawImg,_self.arrayDraw[i].ix,_self.arrayDraw[i].iy,_self.arrayDraw[i].w,_self.arrayDraw[i].h,_self.arrayDraw[i].x,_self.arrayDraw[i].y,_self.arrayDraw[i].w,_self.arrayDraw[i].h)}}else{_self.canContext.drawImage(_self.drawImg,_self.arrayDraw[i].ix,_self.arrayDraw[i].iy-600,_self.arrayDraw[i].w,_self.arrayDraw[i].h,_self.arrayDraw[i].x,_self.arrayDraw[i].y,_self.arrayDraw[i].w,_self.arrayDraw[i].h);_self.arrayDraw[i].iy=_self.arrayDraw[i].iy-600;_self.greenMap.delete(_self.arrayDraw[i].disp)}}}},false)},};window.PhaseCtr=Phase}(jQuery,window,document));